=pod

=head1 NAME

Getopt::Guided - getopts implementation that follows POSIX utility guidelines

=head1 SYNOPSIS

  use Getopt::Guided qw( getopts );

  local @ARGV = qw( -d dv1 -c -v -a av1 -d dv2 -a av2 -d -- -vv v1 v2 );

  getopts 'a:bcd,v+', my %opts;

  # or

  getopts 'a:bcd,v+', ( my %opts ), @ARGV;

  # result
  # %opts == ( a => 'av2', c => !!1, d => [ 'dv1', 'dv2', '--' ], v => 3 )
  # @ARGV == ( 'v1', 'v2' )

=head1 DESCRIPTION

The
L<getopts|https://pubs.opengroup.org/onlinepubs/9799919799/utilities/getopts.html>
POSIX utility retrieves options and option-arguments from a
list of command-line arguments. It supports the L<POSIX utility syntax
guidelines|https://pubs.opengroup.org/onlinepubs/9799919799/basedefs/V1_chap12.html#tag_12_02>
3 to 10, inclusive.

The C<getopts( $;$ )> function of the L<Getopts::Std> core module provides
a rudimentary implementation of this utility.  This module exposes a new
implementation through the C<getopts( $\%;\@ )> function. The primary
implementation differences are

                         | Getopt::Std impl | Getopt::Guided impl
  -----------------------+------------------+----------------------------
  exported               | by default       | on request
  2nd parameter          | hash reference   | hash (passed by reference)
  optional 3rd parameter | none             | array (passed by reference), which
                         |                  | defaults to @ARGV

=head1 COMMAND-LINE ARGUMENTS

A list of command-line arguments consists of options, option-arguments, and
operands.  The arguments that consist of hyphen-minus (C<->) characters and
single alphanumeric (C<[[:alnum:]]>) characters, are known as options. Certain
options are followed by an option-argument.  The arguments following the
last options and option-arguments are named operands.

In Perl the array C<@ARGV> contains the command-line arguments.

=head1 OPTIONS SPECIFICATION

The options specification C<$spec> is the first parameter of the C<getopts()>
function.  It is a non-empty string containing the option names (the single
alphanumeric characters) recognized by the C<getopts()> function.

If an option name is followed by a colon (C<:>) character or a comma (C<,>)
character, the option should have an option-argument which either shall be
supplied as a separate argument (C<( '-a', 'foo' )>) or shall be part of the
same argument string as the option name (C<( '-afoo' )>).  We call an option
whose option name is followed by a colon (comma) option-argument indicator a
"common option" ("list option").  The POSIX standard knows only common options.

An option that does not require an option-argument is called a flag. The flag
name can optionally be followed by an exclamation mark (C<!>) character or
a plus sign (C<+>) character. We call a flag whose flag name is followed by
an exclamation mark (plus sign) flag-type indicator a "negatable flag" (an
"incrementable flag"). The POSIX standard doesn't know flag-type indicators.

=head1 PROCESSING

If a common option is repeated, its arguments overwrite each other and the
last argument wins.

If a list option is repeated, its arguments are pushed onto a list.

The appearance of a flag on the command line sets its value (initial value)
to true (C<!!1>).

If a flag with no indicator is repeated, its initial value will not change.

If a negatable flag is repeated, its initial value will be logically negated
on each occurrence.

If an incrementable flag is repeated, its initial value (its IV value)
will be incremented by one on each occurrence.  Use case: An incrementable
verbosity level can be represented by a C<v+> flag specification.

=head1 DESCRIPTION

The second parameter is the "name-value map" C<%opts>. It is an empty hash
(passed by reference) that stores the C<getopts()> processing result. Each
hash key refers to an option name and the corresponding hash value refers
to the option-argument value (or the flag value). The hash value of a list
option is an array reference.

The new implementation follows the L<POSIX utility syntax
guidelines|https://pubs.opengroup.org/onlinepubs/9799919799/basedefs/V1_chap12.html#tag_12_02>
4 to 10, inclusive. C<getopts()> warns and returns false if a processing error
occurs; otherwise the function returns true. The processing error types are:

=over 3

=item 1.

illegal option

=item 2.

option requires an argument

=back

The second processing error occurs if either no argument or the C<undef>
value is provided for an option that has to have a mandatory argument.

If any of the processing errors occurs, C<getopts()> restores C<@ARGV>
before it warns and returns false.

=head1 API CHANGES

=over 2

=item *

As of version 3.0.0 this module no longer provides the C<getopts3()> function.
Instead of that the C<getopts( $\%;\@ )> function has got a 3rd optional
parameter.  This parameter is an array (passed by reference) of command-line
argument values. It replaces the implicit use of C<@ARGV>.

=item *

As of version 1.1.0 this module provides the additional function C<getopts3(
\@$\% )>.  This function has a 3rd "leading" parameter. This parameter is
an array (passed by reference) of command-line argument values. It replaces
the implicit use of C<@ARGV>. This module exports the C<getopts3()> function
on request too.

=back

=head1 SEE ALSO

=over 2

=item *

L<Tacit list of POSIX short options|https://stackoverflow.com/questions/56131811/is-there-a-tacit-list-of-reserved-names-for-posix-short-options>

=back

=head1 AUTHOR

Sven Willenbuecher <sven.willenbuecher@gmx.de>

=head1 COPYRIGHT AND LICENSE

This software is copyright (c) 2025 by Sven Willenbuecher.

This is free software; you can redistribute it and/or modify it under the
same terms as the Perl 5 programming language system itself.

=cut
